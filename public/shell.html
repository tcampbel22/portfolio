<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minishell</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
			font-family: monospace;
			font-size: x-large;
            width: 100%;
            height: 100%;
            overflow: hidden;
			
            background-color: #000;
        }
		#screen_container canvas {
      		width: 100%; height: 100%; display: block;
      		image-rendering: pixelated;
    	}
        #screen_container {
            width: 100%;
            height: 100%;
            position: relative;
        }
    </style>
</head>
<body>
    <div id="screen_container" tabindex="0">
		<div></div>
		<canvas></canvas>
    </div>
	<button id="save_state_btn" style="position: absolute; top: 10px; left: 10px; z-index: 100;">Save State</button>
    <script src="/libv86.js"></script>
    <script>
        let emulator;
        new window.V86({
            wasm_path: "/v86.wasm",
            screen_container: document.getElementById("screen_container"),
            memory_size: 512 * 1024 * 1024,
            vga_memory_size: 8 * 1024 * 1024,
            network_relay_url: "wss://relay.widgetry.org/",
            initial_state: {
                url: "/images/alpine.v86"
            },
            autostart: true,
        }).then(e => {
            emulator = e;
        });


        document.getElementById("save_state_btn").addEventListener("click", () => {
            if (!emulator) return;
            emulator.save_state().then(state => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob([state], { type: 'application/octet-stream' }));
                a.download = 'minishell.v86';
                a.click();
            });
        });
    </script>
</body>
</html>